<!-- @format -->

<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Desafio 5 en EJS</title>
		<script src="/socket.io/socket.io.js"></script>
		<script>
			const socket = io.connect()
			function render(data) {
				const html = data
					.map((elem, index) => {
						return `<div>
											<strong style='color:blue;'>${elem.email}</strong>:
											<span style='color:red;'>[${elem.date}]</span>
											<em style='color: green;' >${elem.messaje}</em>
										</div>
										`
					})
					.join(' ')
				document.getElementById('mensajes').innerHTML = html
			}

			function renderProducts(data) {
				console.log('data......', data)
				if (data.length === 0) {
					const html = `<h3 style="color: black">No hay lista de productos...</h3>`
					document.getElementById('products').innerHTML = html
				} else {
					const table = data
						.map((elem, index) => {
							return `			
											<tr>
												<td>${elem.id}</td>
												<td>${elem.title}</td>
												<td>${elem.price}</td>
												<td>${elem.category}</td>
												<td>${elem.image}</td>
											</tr>							
										`
						})
						.join(' ')

					const html = `	
													<div class="table-responsive">
														<table class="table table-dark">
															<tr style="color: yellow">
																<th>ID</th>
																<th>Title</th>
																<th>Price</th>
																<th>Category</th>
																<th>Image</th>
															</tr>
															${table}
														</table>
													</div>
												`
					document.getElementById('products').innerHTML = html
				}
			}

			socket.on('messages', function (data) {
				render(data)
			})

			socket.on('products', function (data) {
				renderProducts(data)
			})

			function addMessaje() {
				if (document.getElementById('email').value === '') {
					alert('Agregue un email al chat')
					return false
				}
				if (document.getElementById('messaje').value === '') {
					alert('Agregue un mensaje al chat')
					return false
				}
				const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true }
				const today = new Date()
				const messaje = {
					email: document.getElementById('email').value,
					date: today.toLocaleDateString('es-ES', options),
					messaje: document.getElementById('messaje').value,
				}
				socket.emit('new-message', messaje)
				document.getElementById('messaje').value = ''
				return false
			}

			function addProduct() {
				if (document.getElementById('title').value === '') {
					alert('Agregue un Titulo al producto')
					return false
				}
				if (document.getElementById('price').value === '') {
					alert('Agregue un Precio al producto')
					return false
				}
				if (document.getElementById('category').value === '') {
					alert('Agregue una Categoria al producto')
					return false
				}
				if (document.getElementById('file').value === '') {
					alert('Agregue una Imagen al producto')
					return false
				}

				const product = {
					title: document.getElementById('title').value,
					price: document.getElementById('price').value,
					category: document.getElementById('category').value,
					image: document.getElementById('file').value,
				}
				socket.emit('new-product', product)
				//document.getElementById('title').value = ''
				//document.getElementById('price').value = ''
				//document.getElementById('category').value = ''
				//document.getElementById('file').value = ''
				return false
			}
		</script>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
			integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
			crossorigin="anonymous"
		/>
	</head>
</html>
